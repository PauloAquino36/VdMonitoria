<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VDMonitoria - Tela Inicial</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #e74c3c;
            --background-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
            --white: #ffffff;
            --light-gray: #f0f2f5;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--background-gradient);
            margin: 0;
            padding: 20px 15px;
            min-height: 100vh;
            box-sizing: border-box;
            color: var(--text-dark);
        }

        main {
            width: 100%;
            max-width: 800px; /* Largura máxima do conteúdo */
            margin: 0 auto;   /* Centraliza o container principal */
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-size: 28px;
            font-weight: 700;
            margin: 0;
        }

        h1 span {
            color: var(--secondary-color);
        }

        .user-photo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-color);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.3s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .user-photo:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
        }

        .user-photo svg {
            width: 30px;
            height: 30px;
            fill: var(--white);
        }

        .search-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .filter-btn {
            padding: 10px 20px;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            background: var(--white);
            color: var(--primary-color);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s, color 0.3s;
        }

        .filter-btn.active, .filter-btn:hover {
            background: var(--primary-color);
            color: var(--white);
        }

        .search-box {
            display: flex;
            width: 100%;
            max-width: 550px;
            background: var(--white);
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
        }

        .search-box input {
            flex-grow: 1;
            padding: 15px 20px;
            border: none;
            font-size: 16px;
            outline: none;
        }

        .search-box button {
            padding: 15px 30px;
            border: none;
            background: linear-gradient(90deg, #3498db 0%, #1abc9c 100%);
            color: var(--white);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .search-box button:hover {
            transform: scale(1.05);
        }

        .results {
            width: 100%;
            max-width: 550px;
        }

        .result-card {
            background: var(--white);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s, box-shadow 0.3s;
            cursor: pointer;
        }

        .result-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
        }

        .result-card h3 {
            margin: 0 0 5px 0;
            font-size: 18px;
        }
        
        .result-card p {
            margin: 0;
            color: var(--text-light);
            font-size: 14px;
        }

        .stars {
            display: flex;
            gap: 5px;
        }

        .stars svg {
            width: 20px;
            height: 20px;
            fill: #f39c12;
        }

        .stars .empty {
            fill: #ddd;
        }

        /* ESTILOS DO MODAL */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 15px;
            box-sizing: border-box;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: var(--white);
            padding: 30px;
            border-radius: 12px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            transform: scale(0.9);
            transition: transform 0.3s;
        }
        .modal-overlay.visible .modal-content {
            transform: scale(1);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ddd;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        .modal-header h2 {
            margin: 0;
            font-size: 22px;
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-light);
        }
        .modal-body p {
            font-size: 16px;
            line-height: 1.6;
            margin: 10px 0;
        }
        .modal-body p strong {
            color: #34495e;
        }
        .modal-footer {
            margin-top: 30px;
            text-align: right;
        }
        .contratar-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            color: var(--white);
            background: linear-gradient(90deg, #e74c3c 0%, #f39c12 100%);
            transition: transform 0.2s, box-shadow 0.3s;
        }
        .contratar-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4);
        }

        /* MEDIA QUERIES PARA RESPONSIVIDADE */
        @media (max-width: 768px) {
            body {
                padding: 0;
            }
            main {
                padding: 20px 15px;
                gap: 25px;
            }
            h1 {
                font-size: 24px;
            }
            .user-photo {
                width: 45px;
                height: 45px;
            }
            .user-photo svg {
                width: 25px;
                height: 25px;
            }
        }
    </style>
</head>
<body>
    <main>
        <div class="header">
            <h1><span>VD</span>monitoria</h1>
            <a href="profile.html" class="user-photo" aria-label="Abrir perfil do usuário">
                <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
            </a>
        </div>

        <div class="search-container">
            <div class="filters">
                <button class="filter-btn" data-filter="modalidade" data-value="Presencial">Presencial</button>
                <button class="filter-btn" data-filter="modalidade" data-value="Online">Online</button>
            </div>
            <div class="search-box">
                <input type="text" placeholder="Buscar por matéria..." aria-label="Buscar monitorias">
                <button type="button">Buscar</button>
            </div>
            <div class="results">
                </div>
        </div>
    </main>

    <div class="modal-overlay" id="monitoria-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-materia"></h2>
                <button class="modal-close" id="modal-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <p><strong>Monitor(a):</strong> <span id="modal-tutor"></span></p>
                <p><strong>Curso do Monitor:</strong> <span id="modal-curso"></span></p>
                <p><strong>Horário:</strong> <span id="modal-horario"></span></p>
                <p><strong>Modalidade:</strong> <span id="modal-modalidade"></span></p>
                <p><strong>Valor:</strong> R$ <span id="modal-valor"></span> / hora</p>
            </div>
            <div class="modal-footer">
                <button class="contratar-btn">Contratar Monitoria</button>
            </div>
        </div>
    </div>

    <script>
    // Todo o seu JavaScript anterior para a lógica da página vai aqui.
    // Ele não precisa de alterações.
    document.addEventListener('DOMContentLoaded', async () => {
        const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
        if (!loggedInUser) {
            alert('Você precisa estar logado para acessar esta página.');
            window.location.href = 'login.html';
            return;
        }

        const searchButton = document.querySelector('.search-box button');
        const searchInput = document.querySelector('.search-box input');
        const resultsContainer = document.querySelector('.results');
        const filterButtons = document.querySelectorAll('.filter-btn');
        const modalOverlay = document.getElementById('monitoria-modal');
        const modalCloseBtn = document.getElementById('modal-close-btn');

        const db = await fetch('./db.json').then(res => res.json());
        let allMonitorias = [];
        db.forEach(user => {
            user.monitoriasAtuais.forEach(monitoria => {
                allMonitorias.push({ ...monitoria, tutor: user.nomeCompleto, curso: user.curso, userId: user.id });
            });
        });

        let activeFilters = {};

        filterButtons.forEach(button => {
            button.addEventListener('click', () => {
                const filterType = button.dataset.filter;
                const filterValue = button.dataset.value;
                const isAlreadyActive = button.classList.contains('active');

                document.querySelectorAll(`.filter-btn[data-filter="${filterType}"]`).forEach(btn => btn.classList.remove('active'));
                
                if (!isAlreadyActive) {
                    button.classList.add('active');
                    activeFilters[filterType] = filterValue;
                } else {
                    delete activeFilters[filterType];
                }
                performSearch();
            });
        });

        function performSearch() {
            const query = searchInput.value.toLowerCase().trim();
            
            let filteredResults = allMonitorias.filter(monitoria => {
                const matchesQuery = query ? monitoria.materia.toLowerCase().includes(query) : true;
                const matchesFilters = Object.entries(activeFilters).every(([key, value]) => {
                    return monitoria[key] && monitoria[key].toLowerCase() === value.toLowerCase();
                });
                return matchesQuery && matchesFilters;
            });
            renderResults(filteredResults);
        }

        function renderResults(results) {
            resultsContainer.innerHTML = '';
            if (results.length === 0) {
                resultsContainer.innerHTML = '<p style="text-align: center; color: #555;">Nenhuma monitoria encontrada.</p>';
                return;
            }

            results.forEach(monitoria => {
                const avgScore = monitoria.scores.numeroAvaliacoes > 0 ? monitoria.scores.totalAvaliacoes / monitoria.scores.numeroAvaliacoes : 0;
                const card = document.createElement('div');
                card.className = 'result-card';
                card.dataset.monitoriaId = monitoria.idMonitoria;
                
                card.innerHTML = `
                    <div>
                        <h3>${monitoria.materia}</h3>
                        <p>Tutor(a): ${monitoria.tutor}</p>
                    </div>
                    <div class="stars">${renderStars(avgScore)}</div>
                `;
                resultsContainer.appendChild(card);
            });
        }

        function renderStars(score) {
            let starsHtml = '';
            const fullStars = Math.round(score);
            for (let i = 0; i < 5; i++) {
                starsHtml += `<svg viewBox="0 0 24 24" class="${i < fullStars ? '' : 'empty'}"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.7L5.82 21z"/></svg>`;
            }
            return starsHtml;
        }

        resultsContainer.addEventListener('click', (event) => {
            const card = event.target.closest('.result-card');
            if (card) {
                const monitoriaId = parseInt(card.dataset.monitoriaId, 10);
                const monitoriaData = allMonitorias.find(m => m.idMonitoria === monitoriaId);
                if (monitoriaData) openModal(monitoriaData);
            }
        });

        function openModal(monitoria) {
            document.getElementById('modal-materia').textContent = monitoria.materia;
            document.getElementById('modal-tutor').textContent = monitoria.tutor;
            document.getElementById('modal-curso').textContent = monitoria.curso;
            document.getElementById('modal-horario').textContent = monitoria.horario;
            document.getElementById('modal-modalidade').textContent = monitoria.modalidade;
            document.getElementById('modal-valor').textContent = monitoria.valorHora.toFixed(2).replace('.', ',');
            modalOverlay.classList.add('visible');
        }

        function closeModal() {
            modalOverlay.classList.remove('visible');
        }

        modalCloseBtn.addEventListener('click', closeModal);
        modalOverlay.addEventListener('click', (event) => {
            if (event.target === modalOverlay) closeModal();
        });

        searchButton.addEventListener('click', performSearch);
        searchInput.addEventListener('keyup', performSearch);
        
        performSearch(); // Busca inicial
    });
    </script>
</body>
</html>